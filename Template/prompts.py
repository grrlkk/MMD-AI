from langchain.prompts import PromptTemplate


# **(임시)**질문 생성을 위한 프롬프트 템플릿
##########################################################
question_generation_prompt = PromptTemplate(
    input_variables=["question"],
    template="""사용자 질문: {question}

위 질문을 더 구체적으로 작성하세요."""
)
##########################################################

# # 직무 검증을 위한 프롬프트 템플릿
# job_recommendation_prompt = PromptTemplate(
#     input_variables=[
#         "user_profile",
#         "회사 1", "직무 1", "위치 1", "자격 요건 1", "우대 사항 1", "원본 1", "코사인유사도 1",
#         "회사 2", "직무 2", "위치 2", "자격 요건 2", "우대 사항 2", "원본 2", "코사인유사도 2",
#         "회사 3", "직무 3", "위치 3", "자격 요건 3", "우대 사항 3", "원본 3", "코사인유사도 3",
#         "회사 4", "직무 4", "위치 4", "자격 요건 4", "우대 사항 4", "원본 4", "코사인유사도 4",
#         "회사 5", "직무 5", "위치 5", "자격 요건 5", "우대 사항 5", "원본 5", "코사인유사도 5"
#     ],
#     template="""
# 사용자 프로필:
# {user_profile}

# 아래는 추천 후보 직무 목록입니다. 각 직무의 '회사', '직무', '위치', '자격 요건', '우대 사항', '유사도 점수' 정보를 참고하세요.

# 각 직무별로 아래 3가지 항목에 대해 사용자 프로필과 일치하는지 0 또는 1로 판단하세요.

# 1.  **희망 직무 매칭**: 사용자 프로필의 '희망 직무'와 채용 공고의 '{직무 1}'가 의미상 일치하는가?
# 2.  **기술 스택 매칭**: 사용자 프로필의 '기술 스택'이 채용 공고의 '{자격 요건 1}' 또는 '{우대 사항 1}' 내용과 일치하는가?
# 3.  **희망 근무지 매칭**: 사용자 프로필의 '희망 근무지'와 채용 공고의 '{위치 1}'가 일치하는가?
#     (규칙: '서울'과 '서울시'처럼 시(City) 단위로 일치하거나, 수도권(서울, 경기, 인천) / 비수도권 단위로 일치하는 경우도 매칭(1)으로 인정한다.)

# 위의 매칭 점수(0/1) 합계(최대 3점)와 코사인 유사도 점수를 다음 공식에 따라 가중 평균하여 최종 점수를 계산하세요.
# **최종 점수 = (매칭 점수 합계 / 3 * 0.5 + 코사인 유사도 점수 * 0.5)**

# ---
# [분석 과정]
# 각 직무별로 아래와 같이 표로 정리하여 분석 과정을 보여주세요.

# 1) 회사: {회사 1}
#    - 매칭 점수: (희망 직무: 0/1, 기술 스택: 0/1, 희망 근무지: 0/1)
#    - 매칭 점수 합계: (예: 2)
#    - 코사인 유사도 점수: {코사인유사도 1}
#    - 최종 점수: (계산 결과)

# 2) 회사: {회사 2}
#    - 매칭 점수: (희망 직무: 0/1, 기술 스택: 0/1, 희망 근무지: 0/1)
#    - 매칭 점수 합계: (예: 3)
#    - 코사인 유사도 점수: {코사인유사도 2}
#    - 최종 점수: (계산 결과)

# 3) 회사: {회사 3}
#    - 매칭 점수: (희망 직무: 0/1, 기술 스택: 0/1, 희망 근무지: 0/1)
#    - 매칭 점수 합계: (예: 3)
#    - 코사인 유사도 점수: {코사인유사도 3}
#    - 최종 점수: (계산 결과)

# 4) 회사: {회사 4}
#    - 매칭 점수: (희망 직무: 0/1, 기술 스택: 0/1, 희망 근무지: 0/1)
#    - 매칭 점수 합계: (예: 3)
#    - 코사인 유사도 점수: {코사인유사도 4}
#    - 최종 점수: (계산 결과)

# 5) 회사: {회사 5}
#    - 매칭 점수: (희망 직무: 0/1, 기술 스택: 0/1, 희망 근무지: 0/1)
#    - 매칭 점수 합계: (예: 3)
#    - 코사인 유사도 점수: {코사인유사도 5}
#    - 최종 점수: (계산 결과)
# ---

# [최종 답변]
# 최종적으로 아래와 같은 JSON 형식으로만 답변하세요.

# {{
#   "selected_job_index": "가장 점수가 높은 직무의 번호 (1에서 5 사이의 숫자)",
#   "selected_job_reason": "각 항목별 매칭 근거와 점수 계산 과정, 그리고 최종적으로 해당 직무를 선정한 이유를 구체적으로 작성하세요."
# }}
# """
# )

# # 직무 검증을 위한 프롬프트 템플릿
# ##########################################################
# job_verification_prompt = PromptTemplate(
#     input_variables=["user_profile", "question", "job_document"],
#     template="""
# 사용자 프로필: {user_profile}
# 질문: {question}
# 직무 문서 (직무, 회사, 직무 카테고리, 태그, 위치, 마감일, 포지션 상세, 주요 업무, 자격 요건, 우대 사항, 기술 스택, 혜택 및 복지, 채용 과정, 채용공고 URL 포함):
# {job_document}

# 위 문서가 사용자의 질문과 프로필에 적합한지 평가하세요. 적합하면 반드시 소문자 true, 적합하지 않으면 반드시 소문자 false만을 출력하세요. (예: true 또는 false)
# 다른 부가 설명, JSON, 문장 등은 절대 출력하지 마세요.
# """
# )

##########################################################

preparation_advice_prompt = PromptTemplate(
    input_variables=["user_profile", "job_data"],
    template="""사용자 프로필: {user_profile}

직무 정보 (직무, 회사, 주요 업무, 자격 요건, 기술 스택, 혜택 및 복지, 희망 근무지, 채용 과정 등 포함):
{job_data}

위 정보를 바탕으로 직무 준비 조언을 제공하세요."""
)

summary_memory_prompt = PromptTemplate(
    # input_variables는 invoke 메서드에 전달될 딕셔너리의 키와 일치해야 합니다.
    input_variables=["summary", "new_lines"],
    
    # AI에게 역할을 부여하고, 기존 요약본과 새 대화 내용을 명확히 구분하여 전달합니다.
    template="""당신은 대화 내용을 계속해서 누적하여 요약하는 유용한 AI 어시스턴트입니다.

현재까지의 대화 요약본은 다음과 같습니다:
{summary}

최근에 다음과 같은 대화가 추가되었습니다:
{new_lines}

기존 요약본에 최근 대화 내용을 자연스럽게 통합하여, 전체 대화의 맥락을 담은 새로운 요약본을 만들어 주세요.
만약 기존 요약본이 비어있다면, 최근 대화 내용만으로 첫 요약본을 생성하면 됩니다.
"""
)

# 최종 답변 생성을 위한 프롬프트 템플릿
final_answer_prompt = PromptTemplate(
    input_variables=["user_profile", "question", "selected_job", "search_result", "preparation_advice"],
    template="""당신은 사용자의 구체적인 고민에 공감하고, 주어진 정보를 활용하여 실질적인 해결책을 제시하는 전문 커리어 코치입니다.

당신의 최우선 목표는 사용자의 **{question}**에 직접적으로 답변하는 것입니다.

아래에 제공된 [추천 회사 정보]와 [준비 조언]은 단순히 나열하는 것이 아니라, 사용자의 질문에 대한 답변을 뒷받침하는 **핵심 근거**로 활용해야 합니다.

**[매우 중요]**
사용자의 고민(예: '블록체인 경험이 없는데 기여할 수 있을까요?')과 [준비 조언]의 각 항목을 직접적으로 연결하여, '왜' 이 조언이 사용자의 현재 문제를 해결하는 데 도움이 되는지 구체적으로 설명해주세요.

예를 들어, "Selenium 학습"이라는 조언이 있다면, "Selenium을 통해 테스트 자동화 역량을 키우는 것은, 귀하가 비록 블록체인 도메인 지식은 부족하더라도 강력한 QA 엔지니어링 기술로 팀의 개발 효율성을 높이는 데 직접적으로 기여할 수 있는 방법입니다." 와 같이 연결해야 합니다.

---
[사용자 프로필]
{user_profile}

[사용자 질문]
{question}

[추천 회사 정보]
{selected_job}

[인터넷 검색 추가 정보]
{search_result}

[준비 조언]
{preparation_advice}
---

위 내용을 바탕으로 사용자의 질문에 대한 맞춤형 답변을 친절하고 전문적인 어조로 작성해주세요.
"""
)

# 의도 분석을 위한 프롬프트 템플릿
intent_analysis_prompt = PromptTemplate(
    input_variables=["chat_history", "question"],
    template="""당신은 대화의 맥락을 파악하여 사용자 의도를 5가지 중 하나로 분류하는 AI입니다.
대화 기록과 현재 질문을 바탕으로 가장 적절한 의도를 하나만 선택하여 소문자로 출력하세요.
(initial_search, new_search, select_job, follow_up_qa, chit_chat)

1.  **initial_search**: 사용자가 대화의 가장 처음에서, 구체적인 조건(전공, 경력 등)을 제시하며 직무 추천을 '처음으로' 요청하는 경우.
2.  **new_search**: 이미 직무 목록을 추천받은 후에, "다른 회사 추천해줘", "이거 말고 다른거" 와 같이 '새로운 목록'을 요구하는 경우. (추천 결과 불만족 포함)
3.  **select_job**: 바로 직전의 AI 응답이 '추천 공고 목록'이었고, 사용자가 그 목록에서 특정 항목을 선택하는 경우. (예: "1번 알려줘", "두 번째 회사 정보 좀", "넥써쓰 회사에 대해 더 궁금해요")
4.  **follow_up_qa**: 특정 회사에 대한 '심층 분석이 완료된 후', 그 회사에 대해 추가적인 질문을 하는 경우. (예: "그럼 면접은 어떻게 준비해야 할까요?", "연봉 정보는 없나요?")
5.  **chit_chat**: "고마워", "안녕" 등 직무 추천과 직접적인 관련이 없는 일상적인 대화.

[대화 기록]
{chat_history}

[현재 사용자 질문]
{question}

[분류 결과]
"""
)

# 후속 질문 답변을 위한 프롬프트 템플릿
contextual_qa_prompt = PromptTemplate(
    input_variables=["company_context", "web_search_context", "question"],
    template="""당신은 채용 공고와 웹 검색 결과를 바탕으로 사용자의 질문에 답변하는 AI 어시스턴트입니다.
제공된 [채용 공고 내용]과 [웹 검색 정보]를 근거로 하여 질문에 대해 상세하고 친절하게 답변해주세요.

- 만약 정보가 없다면, "제공된 정보만으로는 답변하기 어렵습니다." 라고 솔직하게 답변하세요.
- 절대로 추측해서 답변하지 마세요.

[채용 공고 내용]
{company_context}

[웹 검색 정보]
{web_search_context}

[사용자 질문]
{question}

[답변]
"""
)

# 다른 회사로 변환되었을 때 심층분석에서의 새로운 쿼리 생성
reformulate_query_prompt = PromptTemplate(
    input_variables=["context", "question"],
    template="""당신은 대화의 전체 맥락을 이해하고, 사용자의 다음 검색 의도를 하나의 검색어로 요약하는 AI입니다.
[이전 대화 맥락]
{context}

[사용자의 마지막 요청]
{question}

[지시사항]
위 모든 내용을 바탕으로, 사용자가 진짜 원하는 '다음 검색어'를 한 문장으로 생성하세요.
예시 1: 마지막 요청이 "다른거 찾아줘"라면, 이전 맥락을 바탕으로 "서울 QA 엔지니어"를 생성합니다.
예시 2: 마지막 요청이 "그럼 이번엔 판교로"라면, 이전 맥락과 조합하여 "판교 QA 엔지니어"를 생성합니다.

[생성된 검색어]:
"""
)